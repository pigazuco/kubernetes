---
- name: DEPLOY WEB-SERVER
  hosts: kb-controller
  gather_facts: no
  vars_prompt:
    - name: "namespace"
      prompt: "namespace"
      default: "my-namespace"
      private: no
    - name: "replicas"
      prompt: "replicas"
      default: "2"
      private: no
  tasks:
    - name: Copy deployment-nginx.yaml
      copy:
        src: /$WORKSPACE/kubernetes/deploy-nginx.yml
        dest: /root/deploy-nginx.yml
    - name: Deploy project
      command: "{{item}}"
      with_items:
        - kubectl create ns {{namespace}}
        - kubectl -n {{namespace}} apply -f /root/deploy-nginx.yml
        - kubectl expose deployment web-server --type="LoadBalancer" -n {{namespace}}
        - kubectl scale --replicas={{replicas}} -n {{namespace}} -f /tmp/deploy-nginx.yml
