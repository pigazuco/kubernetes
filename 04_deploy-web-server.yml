---
- name: DEPLOY WEB-SERVER
  hosts: kb-controller
  gather_facts: no
  tasks:
    - name: Copy deployment-nginx.yaml
      copy:
        src: /var/lib/jenkins/workspace/deploy-kubernetes/deploy-nginx.yml
        dest: /root/deploy-nginx.yml
    - name: Deploy project
      command: "{{item}}"
      with_items:
        - kubectl create ns {{namespace}}
        - kubectl -n {{namespace}} apply -f /root/deploy-nginx.yml
        - kubectl expose deployment web-server --type="LoadBalancer" -n {{namespace}}
        - kubectl scale --replicas={{replicas}} -n {{namespace}} -f /root/deploy-nginx.yml
